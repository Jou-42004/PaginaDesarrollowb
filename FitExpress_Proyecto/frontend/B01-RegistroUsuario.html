<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro - Fit Express</title>
  <meta name="description" content="Reg√≠strate en Fit Express para disfrutar de bowls proteicos y snacks saludables">
  <style>
    :root{ --text:#ecfdf5; --muted:#b7e4cf; --panel:#0e2a1a; --ring:rgba(34,197,94,.35); --accent:#22c55e; --cta:#6d28d9; --cta-text:#f9f5ff; --error:#ef4444; --success:#10b981; }
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,sans-serif;background:#0b1f14;color:var(--text)}
    
    /* Header */
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(8px);background:linear-gradient(180deg, rgba(11,42,24,.9), rgba(11,42,24,.65));border-bottom:1px solid rgba(183,210,192,.18);padding:8px 0}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;height:60px}
    .logo{font-weight:900;color:#fff;text-decoration:none;font-size:20px;display:flex;align-items:center;gap:10px}
    .logo span{background:#19c268;padding:4px 8px;border-radius:6px;font-size:14px}
    .icon-btn{display:grid;place-items:center;width:40px;height:40px;border-radius:12px;border:1px solid rgba(183,210,192,.25);background:rgba(17, 57, 35, 0.6);text-decoration:none;color:white}

    /* Main */
    .main-content { min-height: calc(100vh - 160px); display: flex; align-items: center; justify-content: center; padding: 40px 0; }
    .registration-card { background: linear-gradient(180deg, rgba(18,56,35,.85), rgba(10,38,23,.85)); border: 1px solid rgba(183,210,192,.18); border-radius: 20px; padding: 40px 30px; width: 100%; max-width: 500px; box-shadow: 0 20px 40px rgba(0,0,0,.3); }
    
    .registration-header { text-align: center; margin-bottom: 30px; }
    .registration-header h1 { font-size: 28px; margin: 0 0 10px; color: var(--text); }
    .registration-header p { color: var(--muted); margin: 0; font-size: 16px; }
    
    /* Formulario */
    .form-row { display: flex; gap: 15px; }
    .form-group { margin-bottom: 20px; flex: 1; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text); font-size: 14px; }
    
    .form-control { width: 100%; padding: 12px 16px; background: rgba(11, 42, 24, 0.7); border: 1px solid rgba(183,210,192,.25); border-radius: 10px; color: var(--text); font-size: 16px; transition: all 0.2s ease; }
    .form-control:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--ring); }
    .form-control.error { border-color: var(--error); }
    
    .error-message { color: var(--error); font-size: 12px; margin-top: 5px; display: none; }
    
    /* Botones */
    .btn { display: flex; align-items: center; justify-content: center; padding: 14px 24px; border-radius: 12px; font-weight: 700; font-size: 16px; text-decoration: none; border: none; cursor: pointer; transition: all 0.2s ease; width: 100%; margin-top: 10px; }
    .btn-primary { background: var(--cta); color: var(--cta-text); }
    .btn-primary:hover { filter: brightness(.9); transform: translateY(-2px); }
    .btn-secondary { background: rgba(183,210,192,.1); color: var(--text); border: 1px solid rgba(183,210,192,.25); margin-top: 20px; }
    .btn-secondary:hover { background: rgba(183,210,192,.2); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .divider { display: flex; align-items: center; margin: 25px 0; color: var(--muted); font-size: 14px; }
    .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: rgba(183,210,192,.2); margin: 0 10px; }

    @media (max-width: 576px) { .form-row { flex-direction: column; gap: 0; } }
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <a href="index.html" class="logo"><span>FE</span> Fit Express</a>
      <a href="index.html" class="icon-btn">üè†</a>
    </div>
  </header>

  <div class="main-content">
    <div class="container" style="display:flex; justify-content:center;">
      <div class="registration-card">
        <div class="registration-header">
          <h1>Crear Cuenta</h1>
          <p>√önete para guardar tu carrito y gestionar pedidos</p>
        </div>
        
        <form id="registroForm">
          <div class="form-row">
            <div class="form-group">
              <label>Nombre Completo</label>
              <input type="text" id="name" class="form-control" placeholder="Ej: Juan P√©rez" required>
            </div>
            <div class="form-group">
              <label>RUT</label>
              <input type="text" id="rut" class="form-control" placeholder="12.345.678-9" required>
            </div>
          </div>
          
          <div class="form-group">
            <label>Correo electr√≥nico</label>
            <input type="email" id="email" class="form-control" placeholder="juan@gmail.com" required>
            <div class="error-message">Correo ya registrado o inv√°lido</div>
          </div>
          
          <div class="form-group">
            <label>Contrase√±a</label>
            <input type="password" id="password" class="form-control" placeholder="M√≠nimo 5 caracteres" required>
          </div>
          
          <div class="form-group">
            <label>Direcci√≥n de Env√≠o</label>
            <input type="text" id="address" class="form-control" placeholder="Calle y n√∫mero" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Comuna</label>
              <input type="text" id="commune" class="form-control" placeholder="Ej: Santiago" required>
            </div>
            <div class="form-group">
              <label>Tel√©fono</label>
              <input type="tel" id="phone" class="form-control" placeholder="+56 9..." required>
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary" id="btnRegister">Crear cuenta</button>
        </form>
        
        <div class="divider">o</div>
        
        <a href="B02-InicioSesion.html" class="btn btn-secondary">¬øYa tienes cuenta? Inicia sesi√≥n</a>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://127.0.0.1:8000";

    document.getElementById('registroForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('btnRegister');
      const errorMsg = document.querySelector('.error-message');
      const emailInput = document.getElementById('email');
      
      // Reset visual
      btn.textContent = "Guardando...";
      btn.disabled = true;
      errorMsg.style.display = 'none';
      emailInput.classList.remove('error');

      // Preparar datos para el Backend (Schema UsuarioCreate)
      const nuevoUsuario = {
        nombre: document.getElementById('name').value,
        rut: document.getElementById('rut').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        direccion: document.getElementById('address').value,
        comuna: document.getElementById('commune').value,
        region: "Metropolitana", // Valor por defecto
        telefono: document.getElementById('phone').value
      };

      try {
        const res = await fetch(`${API_URL}/auth/registro`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(nuevoUsuario)
        });

        const data = await res.json();

        if (res.ok) {
          // √âxito
          alert("¬°Cuenta creada exitosamente! Ahora puedes iniciar sesi√≥n.");
          window.location.href = "B02-InicioSesion.html";
        } else {
          // Error (ej: email duplicado)
          if (data.detail.includes("registrado")) {
            emailInput.classList.add('error');
            errorMsg.textContent = "Este correo ya est√° registrado";
            errorMsg.style.display = 'block';
          } else {
            alert("Error: " + data.detail);
          }
        }
      } catch (error) {
        console.error(error);
        alert("No se pudo conectar con el servidor.");
      } finally {
        btn.textContent = "Crear cuenta";
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>