<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Restablecer contraseña — Fit Express</title>
  <meta name="description" content="Restablece tu contraseña de Fit Express de forma segura.">
  <style>
    :root{
      --text:#ecfdf5; --muted:#b7e4cf; --panel:#0e2a1a; --ring:rgba(34,197,94,.35);
      --accent:#22c55e; --cta:#6d28d9; --cta-text:#f9f5ff;
      --hero-overlay: radial-gradient(900px 700px at 110% -10%, rgba(34,197,94,.30) 0%, rgba(34,197,94,0) 60%);
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;background:#0b1f14;color:var(--text)}

    /* Header (coincide con el index) */
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter:blur(8px);
      background:linear-gradient(180deg, rgba(11,42,24,.9), rgba(11,42,24,.65));
      border-bottom:1px solid rgba(183,210,192,.18);
      padding:8px 0;
    }
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;height:60px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:900}
    .logo{width:32px;height:32px;border-radius:8px;background:#19c268;box-shadow:0 0 18px #19c268 inset,0 0 18px #19c268;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:14px}
    .brand span{font-size:20px;color:var(--text)}
    .actions{display:flex;align-items:center;gap:10px;margin-left:auto}
    .link{color:var(--muted);text-decoration:none;border:1px solid rgba(183,210,192,.25);padding:10px 14px;border-radius:12px;background:rgba(17,57,35,.6);transition:.2s}
    .link:hover{border-color:var(--accent);background:rgba(34,197,94,.15);box-shadow:0 4px 12px rgba(34,197,94,.2)}

    /* Lienzo principal */
    .wrap{
      min-height:calc(100dvh - 60px);
      display:grid;place-items:center;
      padding:32px 16px;
      background:
        var(--hero-overlay),
        radial-gradient(1000px 700px at -10% -10%, rgba(34,197,94,.08) 0%, rgba(34,197,94,0) 60%);
    }

    /* Card */
    .card{
      width:100%; max-width:720px;
      background:linear-gradient(180deg, rgba(18,56,35,.65), rgba(10,38,23,.65));
      border:1px solid rgba(183,210,192,.18);
      border-radius:20px; overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,.3);
      display:grid; grid-template-columns:1fr 1fr;
    }
    @media (max-width:860px){.card{grid-template-columns:1fr}}

    .card-media{
      background:
        linear-gradient(180deg, rgba(18,56,35,.35), rgba(10,38,23,.8)),
        url('imagenes/bowl-prote.png') center/cover no-repeat;
      min-height:260px;
      display:flex;flex-direction:column;justify-content:flex-end;gap:10px;
      padding:20px;
      border-right:1px solid rgba(183,210,192,.18);
    }
    .pill{display:inline-block;background:#d1fae5;color:#065f46;padding:6px 12px;border-radius:999px;font-weight:800;font-size:12px}
    .media-title{margin:6px 0 0;font-size:22px}
    .media-sub{margin:0;color:var(--muted);font-size:14px}

    .card-body{padding:22px}
    .card-body h1{margin:0 0 6px;font-size:clamp(22px,3.6vw,28px)}
    .card-body p.lead{margin:0 0 18px;color:var(--muted)}

    /* Stepper */
    .steps{display:flex;gap:8px;margin:10px 0 22px}
    .step{flex:1;height:6px;border-radius:999px;background:rgba(183,210,192,.25);overflow:hidden}
    .step.active{background:linear-gradient(90deg, var(--accent), #16a34a)}

    /* Form */
    form{display:grid;gap:14px}
    .field{display:grid;gap:8px}
    label{font-size:14px;color:#d1fae5}
    input[type="email"],input[type="text"],input[type="password"]{
      width:100%;padding:14px 12px;border-radius:12px;border:1px solid rgba(183,210,192,.25);
      background:rgba(17,57,35,.6);color:var(--text);outline:none;transition:.2s
    }
    input:focus{border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media (max-width:520px){.row{grid-template-columns:1fr}}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:14px 16px;border-radius:12px;border:1px solid rgba(0,0,0,.15);
      font-weight:800;text-decoration:none;cursor:pointer;transition:.2s
    }
    .btn-primary{background:var(--cta);color:var(--cta-text)}
    .btn-primary:hover{filter:brightness(.92);transform:translateY(-1px);box-shadow:0 8px 20px rgba(109,40,217,.3)}
    .btn-ghost{background:transparent;color:var(--muted);border-color:rgba(183,210,192,.25)}
    .btn-ghost:hover{border-color:var(--accent);background:rgba(34,197,94,.08);color:var(--text)}

    .hint{font-size:12px;color:var(--muted)}
    .code-box{letter-spacing:6px;text-align:center;font-weight:800}

    /* Password strength */
    .strength{height:8px;border-radius:999px;background:rgba(183,210,192,.2);overflow:hidden}
    .bar{height:100%;width:0%;background:#ef4444;transition:width .25s ease, background .25s ease;border-radius:999px}
    .tips{font-size:12px;color:var(--muted);margin-top:4px}
    .eye{position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:12px;color:#d1fae5;opacity:.8}

    /* Toasts */
    .toasts{position:fixed;inset:auto 16px 16px auto;display:grid;gap:10px;z-index:50}
    .toast{background:#052e16;color:#d1fae5;border:1px solid rgba(183,210,192,.25);border-left:4px solid var(--accent);padding:12px 14px;border-radius:12px;box-shadow:0 10px 22px rgba(0,0,0,.35)}
    .toast.err{border-left-color:#ef4444}

    footer{padding:26px 16px;color:var(--muted);text-align:center;border-top:1px solid rgba(183,210,192,.18);background:var(--panel);margin-top:32px}
    .back{display:inline-flex;align-items:center;gap:8px;margin:8px 0 16px;color:var(--muted);text-decoration:none}
    .back:hover{color:var(--text)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brand">
        <div class="logo">FE</div><span>Fit Express</span>
      </div>
      <nav class="actions" aria-label="Acciones">
        <a class="link" href="index.html">Volver al inicio</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="card" role="region" aria-labelledby="titulo">
      <!-- Lado visual (coincide con estética del index) -->
      <aside class="card-media" aria-hidden="true">
        <span class="pill">Seguridad primero</span>
        <h2 class="media-title">Restablece tu contraseña</h2>
        <p class="media-sub">Te enviaremos un código al correo registrado para confirmar que eres tú.</p>
      </aside>

      <!-- Formulario -->
      <section class="card-body">
        <a href="B02-InicioSesion.html" class="back" aria-label="Volver a iniciar sesión">← Volver a iniciar sesión</a>
        <h1 id="titulo">¿Olvidaste tu contraseña?</h1>
        <p class="lead">Sigue estos pasos para crear una nueva contraseña.</p>

        <div class="steps" aria-hidden="true">
          <div class="step active" id="s1"></div>
          <div class="step" id="s2"></div>
          <div class="step" id="s3"></div>
        </div>

        <!-- Paso 1: correo -->
        <form id="step1" autocomplete="on" novalidate>
          <div class="field">
            <label for="email">Correo electrónico</label>
            <input id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" required inputmode="email" />
            <span class="hint">Usa el correo con el que te registraste.</span>
          </div>
          <button class="btn btn-primary" type="submit">Enviar código</button>
        </form>

        <!-- Paso 2: código -->
        <form id="step2" style="display:none" novalidate>
          <div class="field">
            <label for="code">Código de verificación</label>
            <input id="code" name="code" class="code-box" type="text" maxlength="6" placeholder="••••••" inputmode="numeric" pattern="[0-9]*" required />
            <span class="hint">Revisa tu bandeja de entrada y spam. <button type="button" id="resend" class="btn btn-ghost" style="padding:6px 10px;margin-left:6px">Reenviar</button></span>
          </div>
          <div class="row">
            <button class="btn btn-ghost" type="button" id="back1">Atrás</button>
            <button class="btn btn-primary" type="submit">Validar código</button>
          </div>
        </form>

        <!-- Paso 3: nueva contraseña -->
        <form id="step3" style="display:none" novalidate>
          <div class="field" style="position:relative">
            <label for="pass1">Nueva contraseña</label>
            <input id="pass1" name="pass1" type="password" required minlength="8" autocomplete="new-password" />
            <button class="eye" type="button" data-for="pass1">Mostrar</button>
            <div class="strength" aria-hidden="true"><div class="bar" id="bar"></div></div>
            <div class="tips">Mínimo 8 caracteres. Recomendado: mayúscula, minúscula, número y símbolo.</div>
          </div>
          <div class="field" style="position:relative">
            <label for="pass2">Repetir contraseña</label>
            <input id="pass2" name="pass2" type="password" required minlength="8" autocomplete="new-password" />
            <button class="eye" type="button" data-for="pass2">Mostrar</button>
          </div>
          <div class="row">
            <button class="btn btn-ghost" type="button" id="back2">Atrás</button>
            <button class="btn btn-primary" type="submit">Guardar y entrar</button>
          </div>
        </form>

        <p class="hint" style="margin-top:8px">¿Recordaste tu clave? <a class="link" style="padding:4px 8px" href="B02-InicioSesion.html">Inicia sesión</a></p>
      </section>
    </div>
  </main>

  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <footer>© <span id="y"></span> Fit Express — Bowls proteicos y snacks saludables</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // Utilidades UI
    const qs = s => document.querySelector(s);
    const show = el => el.style.display = '';
    const hide = el => el.style.display = 'none';
    const step1 = qs('#step1'), step2 = qs('#step2'), step3 = qs('#step3');
    const s1 = qs('#s1'), s2 = qs('#s2'), s3 = qs('#s3');
    function setStep(n){
      [s1,s2,s3].forEach((e,i)=> e.classList.toggle('active', i < n));
      hide(step1); hide(step2); hide(step3);
      if(n===1) show(step1);
      if(n===2) show(step2);
      if(n===3) show(step3);
    }
    function toast(msg, err=false){
      const box = qs('#toasts');
      const t = document.createElement('div');
      t.className = 'toast' + (err ? ' err' : '');
      t.textContent = msg;
      box.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 4000);
    }

    // Paso 1: enviar código (mock)
    step1.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = qs('#email').value.trim();
      if(!email || !/^\S+@\S+\.\S+$/.test(email)) return toast('Ingresa un correo válido', true);

      // TODO: Aquí llamar a tu backend: POST /auth/forgot { email }
      // Simulación:
      await new Promise(r=>setTimeout(r, 500));
      localStorage.setItem('fe_reset_email', email);
      toast('Hemos enviado un código a ' + email);
      setStep(2);
    });

    // Reenviar código (mock)
    qs('#resend').addEventListener('click', async ()=>{
      const email = localStorage.getItem('fe_reset_email') || qs('#email').value;
      if(!email) return toast('Primero ingresa tu correo', true);
      // TODO: POST /auth/forgot { email }
      await new Promise(r=>setTimeout(r, 400));
      toast('Código reenviado a ' + email);
    });

    // Botón atrás
    qs('#back1').addEventListener('click', ()=> setStep(1));

    // Paso 2: validar código (mock)
    step2.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const code = qs('#code').value.trim();
      if(code.length !== 6 || !/^\d{6}$/.test(code)) return toast('El código debe tener 6 dígitos', true);

      // TODO: POST /auth/verify-reset { email, code }
      await new Promise(r=>setTimeout(r, 500));
      sessionStorage.setItem('fe_reset_token', 'token_simulado_' + code);
      toast('Código verificado');
      setStep(3);
    });

    // Atrás desde step 3
    qs('#back2').addEventListener('click', ()=> setStep(2));

    // Mostrar/Ocultar contraseña
    document.querySelectorAll('.eye').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-for');
        const input = qs('#' + id);
        const isPass = input.type === 'password';
        input.type = isPass ? 'text' : 'password';
        btn.textContent = isPass ? 'Ocultar' : 'Mostrar';
      });
    });

    // Medidor de fuerza
    const pass1 = qs('#pass1'), pass2 = qs('#pass2'), bar = qs('#bar');
    function strengthScore(p){
      let s = 0;
      if(p.length >= 8) s++;
      if(/[A-Z]/.test(p)) s++;
      if(/[a-z]/.test(p)) s++;
      if(/\d/.test(p)) s++;
      if(/[^A-Za-z0-9]/.test(p)) s++;
      return Math.min(s, 5);
    }
    function updateBar(){
      const s = strengthScore(pass1.value);
      const pct = [0,20,40,65,85,100][s];
      bar.style.width = pct + '%';
      bar.style.background = s < 3 ? '#ef4444' : (s < 4 ? '#f59e0b' : '#22c55e');
    }
    pass1.addEventListener('input', updateBar);

    // Paso 3: guardar nueva contraseña (mock)
    step3.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const p1 = pass1.value, p2 = pass2.value;
      if(p1.length < 8) return toast('La contraseña debe tener al menos 8 caracteres', true);
      if(p1 !== p2) return toast('Las contraseñas no coinciden', true);

      const email = localStorage.getItem('fe_reset_email');
      const token = sessionStorage.getItem('fe_reset_token');
      if(!email || !token) return toast('Sesión de recuperación inválida. Vuelve a empezar.', true);

      // TODO: POST /auth/reset { email, token, newPassword: p1 }
      await new Promise(r=>setTimeout(r, 600));
      localStorage.removeItem('fe_reset_email');
      sessionStorage.removeItem('fe_reset_token');
      toast('¡Contraseña actualizada! Redirigiendo a iniciar sesión…');

      // Redirección suave
      setTimeout(()=>{ window.location.href = 'B02-InicioSesion.html'; }, 1200);
    });

    // Inicia en paso 1
    setStep(1);
  </script>
</body>
</html>
