<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Promociones y Combos — Fit Express</title>
  <meta name="description" content="Promociones vigentes y combos de Fit Express.">
  <style>
    :root{
      --text:#ecfdf5; --muted:#b7e4cf; --panel:#0e2a1a; --ring:rgba(34,197,94,.35);
      --accent:#22c55e; --cta:#2563eb; --cta-text:#fff;
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;background:#0b1f14;color:var(--text)}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}

    /* Header (igual a tu index) */
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(8px);
      background:linear-gradient(180deg, rgba(11,42,24,.9), rgba(11,42,24,.65));
      border-bottom:1px solid rgba(183,210,192,.18);padding:8px 0}
    .topbar{display:flex;align-items:center;gap:12px;height:60px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:900}
    .logo{width:32px;height:32px;border-radius:8px;background:#19c268;box-shadow:0 0 18px #19c268 inset,0 0 18px #19c268;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:14px}
    .brand span{font-size:20px}
    .actions{display:flex;align-items:center;gap:12px;margin-left:auto}
    .icon-btn{display:inline-grid;place-items:center;width:40px;height:40px;border-radius:12px;border:1px solid rgba(183,210,192,.25);background:rgba(17,57,35,.6);text-decoration:none}
    .icon{width:20px;height:20px;stroke:#e2e8f0;stroke-width:2}
    .cart-badge{position:absolute;top:-5px;right:-5px;background:#6d28d9;color:#fff;border-radius:999px;width:18px;height:18px;font-size:10px;display:flex;align-items:center;justify-content:center;font-weight:700}

    /* Página */
    main{padding:22px 0 36px}
    .head{display:flex;align-items:end;justify-content:space-between;gap:16px;margin-bottom:14px}
    h1{margin:0;font-size:24px}
    .sub{color:var(--muted);font-size:13px}
    .sort{display:flex;align-items:center;gap:8px}
    select{background:rgba(17,57,35,.6);color:var(--text);border:1px solid rgba(183,210,192,.25);border-radius:10px;padding:10px 12px}
    select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}

    /* Cards */
    .cards{display:grid;gap:18px;grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:780px){.cards{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg, rgba(18,56,35,.65), rgba(10,38,23,.65));
      border:1px solid rgba(183,210,192,.18);border-radius:16px;overflow:hidden;
      display:grid;grid-template-columns:160px auto
    }
    @media (max-width:520px){.card{grid-template-columns:1fr}}
    .thumb{width:100%;height:100%;min-height:160px;object-fit:cover}
    .content{padding:14px 16px;display:grid;gap:6px}
    .title{margin:0;font-size:18px;font-weight:900}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:800;color:#052e16;background:var(--accent)}
    .price{display:flex;align-items:baseline;gap:8px}
    .old{color:var(--muted);text-decoration:line-through}
    .new{font-weight:900}
    .btn{margin-top:8px;display:inline-flex;justify-content:center;align-items:center;padding:10px 14px;border-radius:10px;border:1px solid rgba(0,0,0,.15);cursor:pointer;background:var(--cta);color:#fff;font-weight:800}
    .btn:hover{filter:brightness(.95)}
    footer{padding:26px 16px;color:var(--muted);text-align:center;border-top:1px solid rgba(183,210,192,.18);background:var(--panel);margin-top:24px}

    /* Toast simple */
    .toasts{position:fixed;right:16px;bottom:16px;display:grid;gap:10px;z-index:50}
    .toast{background:#052e16;border:1px solid rgba(183,210,192,.25);border-radius:12px;padding:10px 12px}
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brand"><div class="logo">FE</div><span>Fit Express</span></div>

      <nav class="actions">
        <a class="icon-btn" href="index.html" title="Inicio">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 11l9-8 9 8v9a2 2 0 0 1-2 2h-4V12H9v10H5a2 2 0 0 1-2-2v-9Z"/></svg>
        </a>
        <a class="icon-btn" href="B09-Carrito.html" title="Carrito" style="position:relative">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M6 7h12l-1 12H7L6 7Z"/><path d="M9 7V6a3 3 0 0 1 6 0v1"/></svg>
          <span class="cart-badge" id="cartCount"></span>
        </a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="head">
      <div>
        <h1>Promociones y combos</h1>
        <div class="sub">Vigencia basada en tu zona horaria</div>
      </div>
      <div class="sort">
        <label for="sort" class="sub">Ordenar por</label>
        <select id="sort">
          <option value="discount_desc">Mayor descuento</option>
          <option value="price_asc">Precio más bajo</option>
          <option value="name_asc">Nombre (A-Z)</option>
        </select>
      </div>
    </div>

    <section id="cards" class="cards" aria-live="polite"></section>
  </main>

  <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>

  <footer>© <span id="y"></span> Fit Express — Bowls proteicos y snacks saludables</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
    const CLP = v => v.toLocaleString('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0});

    // --- Datos (usa tus imágenes) ---
    const PRIORITY = { ALTA:3, MEDIA:2, BAJA:1 };
    const products = [
      { id:'combo-proteico', title:'Combo Proteico', img:'imagenes/combo-proteico.jpg', basePrice:7990,
        promos:[{type:'PERCENT', value:15, priority:'ALTA', until: todayAt(23,59)}] },
      { id:'snack-bebida', title:'Snack + Bebida Natural', img:'imagenes/snack-bebida.jpg', basePrice:3990,
        promos:[{type:'BOGO', priority:'BAJA', until:addDays(new Date(),2)}] },
      { id:'bowl-vegano-postre', title:'Bowl Vegano + Postre', img:'imagenes/bowl-vegano-postre.jpg', basePrice:8990,
        promos:[{type:'PERCENT', value:10, priority:'MEDIA', until:addDays(new Date(),1)}] },
      { id:'combo-familia', title:'Combo Familia', img:'imagenes/combo-familia.jpg', basePrice:19990,
        promos:[{type:'PERCENT', value:12, priority:'ALTA', until:addDays(new Date(),5)},
                {type:'PERCENT', value:8, priority:'MEDIA', until:addDays(new Date(),5)}] },
    ];

    // --- Fechas ---
    function addDays(d,days){ const x=new Date(d); x.setDate(x.getDate()+days); return x; }
    function todayAt(h=0,m=0){ const d=new Date(); d.setHours(h,m,0,0); return d; }

    // --- Promos ---
    function listActive(promos, now=new Date()){ return (promos||[]).filter(p=>!p.until || p.until>=now); }
    function resolvePriority(promos){
      if(!promos.length) return null;
      return promos.slice().sort((a,b)=> PRIORITY[b.priority]-PRIORITY[a.priority])[0];
    }
    function priceWithPromo(product){
      const actives = listActive(product.promos);
      const chosen = resolvePriority(actives);
      if(!chosen) return { final:product.basePrice, label:null, type:null };
      if(chosen.type==='PERCENT'){
        const discount = Math.round(product.basePrice*(chosen.value/100));
        return { final:product.basePrice-discount, label:`${chosen.value}% OFF`, type:'PERCENT' };
      }
      if(chosen.type==='BOGO'){ return { final:product.basePrice, label:'2x1', type:'BOGO' }; }
      return { final:product.basePrice, label:null, type:null };
    }

    // --- Carrito (localStorage) ---
    const CART_KEY = 'fe_cart';
    function readCart(){ try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]');}catch{ return []; } }
    function writeCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); updateCartBadge(); }
    function addToCart(id){
      const p = products.find(x=>x.id===id);
      const pricing = priceWithPromo(p);
      const items = readCart();
      const idx = items.findIndex(i=> i.id===id && i.price===pricing.final);
      if(idx>-1){ items[idx].qty += 1; } else {
        items.push({ id, title:p.title, price:pricing.final, qty:1, img:p.img, promo:pricing.label||null });
      }
      writeCart(items);
      toast(`Agregado: <b>${p.title}</b> · ${CLP(pricing.final)}${pricing.label?` <small>(${pricing.label})</small>`:''}`);
    }
    function updateCartBadge(){
      const items = readCart();
      const count = items.reduce((a,b)=>a+b.qty,0);
      const badge = document.getElementById('cartCount');
      if(badge) badge.textContent = count>0 ? count : '';
    }

    // --- UI ---
    const cardsEl = document.getElementById('cards');
    const sortEl = document.getElementById('sort');

    function render(){
      const items = products.map(p=>{
        const pr = priceWithPromo(p);
        const discountPct = pr.type==='PERCENT' ? parseInt(pr.label) : (pr.type==='BOGO'?100:0);
        return {...p, pr, discountPct};
      });

      const sortVal = sortEl.value;
      items.sort((a,b)=>{
        if(sortVal==='discount_desc') return (b.discountPct||0)-(a.discountPct||0);
        if(sortVal==='price_asc') return a.pr.final - b.pr.final;
        if(sortVal==='name_asc') return a.title.localeCompare(b.title);
        return 0;
      });

      cardsEl.innerHTML = items.map(p=>`
        <article class="card">
          <img class="thumb" src="${p.img}" alt="${p.title}">
          <div class="content">
            <h3 class="title">${p.title}</h3>
            ${p.pr.label?`<span class="badge">${p.pr.label}</span>`:''}
            <div class="price">
              ${p.pr.type==='PERCENT' ? `<span class="old">${CLP(p.basePrice)}</span>` : ''}
              <span class="new">${CLP(p.pr.final)}</span>
            </div>
            <button class="btn" onclick="addToCart('${p.id}')">Agregar</button>
          </div>
        </article>
      `).join('');
    }

    function toast(html){
      const box = document.getElementById('toasts');
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = html;
      box.appendChild(t);
      setTimeout(()=> t.remove(), 2500);
    }

    // init
    render();
    updateCartBadge();
    sortEl.addEventListener('change', render);
  </script>
</body>
</html>
